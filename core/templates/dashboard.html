{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<h2 class="mb-4">ダッシュボード</h2>

<!-- 出勤状況 -->
<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <h5 class="card-title">今日の勤務状況</h5>
    {% if today_record %}
      <p class="card-text">
        出勤: {{ today_record.start_time|date:"H:i" }}
        {% if today_record.end_time %}
          ／ 退勤: {{ today_record.end_time|date:"H:i" }}
        {% endif %}
      </p>
      {% if today_record.end_time %}
        <span class="badge bg-secondary">退勤済み</span>
      {% else %}
        <a href="{% url 'clock_out' %}" class="btn btn-danger mt-2">退勤する</a>
      {% endif %}
    {% else %}
      <p class="card-text">まだ出勤していません</p>
      <a href="{% url 'clock_in' %}" class="btn btn-primary">出勤する</a>
    {% endif %}
  </div>
</div>

<!-- タスク -->
<div class="card shadow-sm">
  <div class="card-body">
    <h5 class="card-title">タスク</h5>

    <!-- タスク追加フォーム -->
    <form method="post" action="{% url 'add_task' %}" class="d-flex mb-3">
      {% csrf_token %}
      <input
        type="text"
        name="title"
        class="form-control me-2"
        placeholder="タスク名を入力"
      />
      <button class="btn btn-success">追加</button>
    </form>

    <!-- タスク一覧 -->
    {% for task in tasks %}
      <div class="d-flex justify-content-between align-items-center border-bottom py-2">
        <span class="{% if task.is_done %}text-decoration-line-through text-muted{% endif %}">
          {{ task.title }}
        </span>

        {% if not task.is_done %}
          <a href="{% url 'complete_task' task.id %}" class="btn btn-outline-primary btn-sm">
            完了
          </a>
        {% else %}
          <span class="badge bg-success">完了済み</span>
        {% endif %}
      </div>
    {% empty %}
      <p class="text-muted">タスクはまだありません。</p>
    {% endfor %}
  </div>
</div>

{% endblock %}
